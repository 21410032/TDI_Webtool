{% extends 'base.html' %}

{% block content %}

{% if messages %}
<ul class="messages">
  {% for message in messages %}
  <li{% if message.tags %} class="{{ message.tags }}" {% endif %}>{{ message }}</li>
    {% endfor %}
</ul>
{% endif %}
<form method="post" enctype="multipart/form-data">
  {% csrf_token %}
  {{ formset.management_form }}

  <label for="id_year">Select Year:</label>
  <input type="number" name="year" step="any" id="id_year" required placeholder="Year">




  <!-- <label for="entryType">Select Data Entry Type:</label> -->
  <select id="entryType" onchange="toggleForms()">
    <option value="" disabled selected hidden>-- Data Input Type</option>
    <option value="manual">Manual Entry</option>
    <option value="file">Upload Excel</option>
  </select>

  <div class="file_upload_box" id="HH_fileUpload_form" style="display: none;">
    <input type="file" name="households_excel_file" placeholder="Choose file">
  </div>


  <div id="HH_manual_data_form" style="display: none;">

    <div id="formset">



      {% for form in formset %}
      {{ form.tribe_slug }}
      {{ form.as_p }}
      {% endfor %}
    </div>

    <button type="button" id="add-form">Add Form</button>
    <button type="button" id="remove-form">Remove Last Form</button>
  </div>

  <!-- <input type="submit" value="Submit"> -->
  <button type="submit" class="tribe_form_submit">Submit</button>
</form>
<style>
  /* Container for the entire form */
  form {
    max-width: 800px;
    margin: auto;
    padding: 30px;
    background-color: #f7f7f7;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
    border-radius: 10px;
  }

  /* Style formset container */
  #formset {
    margin-bottom: 30px;
  }

  /* Style each form within the formset */
  #form {
    border: 2px solid #3498db;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 30px;
    background-color: #fff;
    transition: box-shadow 0.3s ease;
  }

  /* Hover effect for each form */
  #form:hover {
    box-shadow: 0 0 30px rgba(52, 152, 219, 0.5);
  }

  /* Style form labels and input fields */
  label {
    display: block;
    margin-bottom: 12px;
    color: #333;
    font-weight: bold;
  }

  input,
  .tribe_form_submit,
  select,
  textarea {
    width: 100%;
    padding: 14px;
    margin-bottom: 20px;
    box-sizing: border-box;
    border: 2px solid #ccc;
    border-radius: 6px;
    background-color: #fff;
    transition: border-color 0.3s ease;
  }

  /* Hover effect for input fields */
  input:hover,
  .tribe_form_submit:hover,
  select:hover,
  textarea:hover {
    border-color: #3498db;
  }

  /* Style the "Add Form" and "Remove Last Form" buttons */
  #add-form,
  #remove-form {
    background-color: #2ecc71;
    color: #fff;
    padding: 14px;
    margin: 10px;
    cursor: pointer;
    border: none;
    border-radius: 6px;
    transition: background-color 0.3s ease;
  }

  #add-form:hover,
  #remove-form:hover {
    background-color: #27ae60;
  }

  /* Style form submission button */
  .tribe_form_submit {
    background-color: #3498db;
    color: #fff;
    padding: 14px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  .tribe_form_submit[type="submit"]:hover {
    background-color: #2980b9;
  }

  /* Responsive design for smaller screens */
  @media (max-width: 600px) {
    form {
      padding: 20px;
    }

    input,
    .tribe_form_submit,
    select,
    textarea {
      margin-bottom: 14px;
    }

    #add-form,
    #remove-form,
    .tribe_form_submit {
      margin: 10px;
    }
  }
</style>
<script>

  document.getElementById('add-form').addEventListener('click', function () {
    // Get the div containing the form elements
    var formsetDiv = document.getElementById('formset');

    // Get the last form in the formset
    var lastForm = formsetDiv.lastElementChild;

    // Clone the last form
    var newForm = lastForm.cloneNode(true);

    // Clear values in the cloned form
    newForm.querySelectorAll('input, select, textarea').forEach(function (element) {
      element.value = '';
    });

    // Increment the form index
    var formCountField = document.getElementById('id_form-TOTAL_FORMS');
    var newFormIndex = parseInt(formCountField.value);
    newFormIndex++;
    formCountField.value = newFormIndex;

    // Update the IDs of form fields in the cloned form
    newForm.querySelectorAll('[id]').forEach(function (element) {
      element.id = element.id.replace(/-\d+/, '-' + (newFormIndex - 1));
    });

    // Update the names of form fields in the cloned form
    newForm.querySelectorAll('[name]').forEach(function (element) {
      element.name = element.name.replace(/-\d+/, '-' + (newFormIndex - 1));
    });
    newForm.querySelectorAll('label').forEach(function (label) {
      var labelFor = label.getAttribute('for');
      if (labelFor) {
        label.setAttribute('for', labelFor.replace(/-\d+/, '-' + (newFormIndex - 1)));
      }
    });
    // Append the new form to the formset
    formsetDiv.appendChild(newForm);
  });

  document.getElementById('remove-form').addEventListener('click', function () {
    // Get the div containing the form elements
    var formsetDiv = document.getElementById('formset');

    // If there is more than one form, remove the last one
    if (formsetDiv.childElementCount > 1) {
      var lastForm = formsetDiv.lastElementChild;
      formsetDiv.removeChild(lastForm);
    }
  });


  function toggleForms() {
    var entryType = document.getElementById("entryType").value;
    var manualForm = document.getElementById("HH_manual_data_form");
    var fileUploadForm = document.getElementById("HH_fileUpload_form");
    var slugSelect = document.getElementById("id_form-0-tribeID");


    if (entryType === "manual") {
      manualForm.style.display = "block";
      fileUploadForm.style.display = "none";
      slugSelect.setAttribute("required", "required");
    } else if (entryType === "file") {
      manualForm.style.display = "none";
      fileUploadForm.style.display = "block";
      slugSelect.removeAttribute("required");
    }
  }




</script>
{% endblock content %}